const multer=require('multer')
const storage=multer.diskStorage({
    destination:(req,res,cb)=>{
        cb(null,'uploads')


    },
    filename:(req,res,cb)=>{
        const uniqueSuffix=Date.now()+'-'+Math.round(Math.random()*1E9)
        cb(null,file.fieldname+'-'+uniqueSuffix)

    }

})
//file filter function 
const checkFilter=(req,file,cb)=>{
    if(file.mimetype.startsWith('image')){
        cb(null,true)
    }
    else{
       cb(new Error('not an image file'),false)
    }
}
//multer middleware
module.exports=multer(({
    storage:storage,
    fileFilter:checkFilter,
    limits:{
        fileSize: 5 * 1024 * 1024,
    }
}))